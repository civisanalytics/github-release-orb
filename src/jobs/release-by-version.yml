description: |
  Publish a new GitHub Release for a repository by finding the version file and CHANGELOG.
  This is intended for Python Repositories since we default to the version.py but other repository
  use is allowed.

executor: default

parameters:
  version-path:
    description: |
      File path to file containing the version. If not specified will default to version.py.
      We will split the line matching version=x.y.z to get the version.
    type: string
    default: version.py
  changelog-path:
    description: File path to the changelog containing the description of the release.
    type: string
    default: CHANGELOG.md
  file-path:
    description: |
      File directory to be uploaded in addition to the full repository.
    type: string
    default: ""
  is-draft:
    description: If true, then the release is a draft.
    type: boolean
    default: false
  is-pre-release:
    description: If true, then the release is a pre-release.
    type: boolean
    default: false
  include-distribution:
    description: If true, then create a distribution and include it in the release.
    type: boolean
    default: false

steps:
  - checkout
  - set-version-details:
      version-path: << parameters.version-path >>
      changelog-path: << parameters.changelog-path >>
  - when:
      condition: << parameters.include-distribution >>
      steps:
        - create-distribution
        - publish:
            current-version: $CURRENT_VERSION
            title: $TITLE
            description: $DESCRIPTION
            file-path: ./dist
            is-draft: << parameters.is-draft >>
            is-pre-release: << parameters.is-pre-release >>
  - unless:
      condition: << parameters.include-distribution >>
      steps:
        - publish:
            current-version: $CURRENT_VERSION
            title: $TITLE
            description: $DESCRIPTION
            file-path: << parameters.file-path >>
            is-draft: << parameters.is-draft >>
            is-pre-release: << parameters.is-pre-release >>
